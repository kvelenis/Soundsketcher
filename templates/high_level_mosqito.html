<!DOCTYPE html>
<html>
<head>
    <title>Audio Feature Extraction with Mosqito</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Upload an Audio File to Extract Features</h1>
    <form id="upload-form" action="/high_level_mosqito" method="post" enctype="multipart/form-data">
        <label for="wav_file">Select a WAV file:</label>
        <input type="file" id="wav_file" name="wav_file" accept=".wav" required>
        <br><br>
        <button type="submit">Upload and Analyze</button>
    </form>

    <h2>Audio Features</h2>
    <div id="plot"></div>

    <script>
        document.getElementById("upload-form").onsubmit = async function(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const response = await fetch("/high_level_mosqito", {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                const data = await response.json();
                renderPlot(data);
            } else {
                alert("Failed to analyze audio.");
            }
        };

        function renderPlot(features) {
            const timepoints = Array.from({ length: features.loudness.length }, (_, i) => i);

            const traces = [
                {
                    x: timepoints,
                    y: features.loudness,
                    mode: 'lines',
                    name: 'Loudness',
                    line: { color: 'blue' }
                },
                {
                    x: timepoints,
                    y: features.sharpness,
                    mode: 'lines',
                    name: 'Sharpness',
                    line: { color: 'green' }
                },
                {
                    x: timepoints,
                    y: features.roughness,
                    mode: 'lines',
                    name: 'Roughness',
                    line: { color: 'red' }
                },
                {
                    x: timepoints,
                    y: features.tonality,
                    mode: 'lines',
                    name: 'Tonality',
                    line: { color: 'orange' }
                },
                {
                    x: timepoints,
                    y: features.speech_intelligibility,
                    mode: 'lines',
                    name: 'Speech Intelligibility',
                    line: { color: 'purple' }
                }
            ];

            const layout = {
                title: 'Audio Features Over Time',
                xaxis: { title: 'Time (frames)' },
                yaxis: { title: 'Feature Value' }
            };

            Plotly.newPlot('plot', traces, layout);
        }
    </script>
</body>
</html>
